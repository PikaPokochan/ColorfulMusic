<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ›²é¸æŠ</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/awesomplete/1.1.5/awesomplete.min.css">
    <style>
        .awesomplete { width: 90%; max-width: 400px; }
        input { padding: 8px; font-size: 16px; width: 100%; box-sizing: border-box; }
        table { width: 100%; border-collapse: collapse; margin-top: 16px; }
        th, td { border: 1px solid #ddd; padding: 8px; text-align: left; }
        th { background:#f5f5f5; }
        #songs-table tbody tr:hover { background:#fafafa; cursor:pointer; }
    </style>
</head>
<body>
    <a href="#" id="info-icon" title="ä½¿ã„æ–¹ã®èª¬æ˜ãƒšãƒ¼ã‚¸">ï¼Ÿ</a>

    <h1>ColorfulMusic<h1>
    <h2>æ¤œç´¢ãƒœãƒƒã‚¯ã‚¹</h2>

    <form id="play-form" action="/glow" method="post">
        <input id="song-input" placeholder="ã‚¢ãƒ¼ãƒ†ã‚£ã‚¹ãƒˆãƒ»æ›²åã‚’å…¥åŠ›ã—ã¦æ¤œç´¢" autocomplete="off">
        <input type="hidden" id="filename" name="filename">
        <br><br>
        <button class="button" type="submit">éŸ³æ¥½ã«åˆã‚ã›ã¦å…‰ã‚‰ã›ã‚‹</button>
    </form>

    <form id="color-form" action="/color" method="post" style="margin-top:8px;">
        <input type="hidden" id="color-filename" name="filename" value="">
        <button class="button" type="submit">è‰²ã‚’æ±ºã‚ã¦å…‰ã‚‰ã›ã‚‹</button>
    </form>

    <ul id="artist-list"></ul>

    <br>
    <br>
    <br>
    <h2>æ›²ãƒªã‚¹ãƒˆ</h2>
    <table id="songs-table">
        <thead>
            <tr><th>Artist</th><th>Title</th></tr>
        </thead>
        <tbody></tbody>
    </table>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/awesomplete/1.1.5/awesomplete.min.js"></script>
    <script>
        // Flaskã‹ã‚‰æ¸¡ã•ã‚ŒãŸ files_with_names: [(file, display), ...]
        const files_with_names = {{ files_with_names | tojson }};
        const songs = files_with_names.map(([file, display]) => {
            const parts = display.split(/-(.+)/);
            if (parts.length > 1) {
                return { file, display, artist: parts[0].trim(), title: parts[1].trim() };
            } else {
                return { file, display, artist: "", title: display.trim() };
            }
        });

        // ãƒ†ãƒ¼ãƒ–ãƒ«ã«å‡ºåŠ›ï¼ˆã‚¯ãƒªãƒƒã‚¯ã§é¸æŠï¼‰
        const tbody = document.querySelector("#songs-table tbody");
        songs.forEach(s => {
            const tr = document.createElement("tr");
            tr.dataset.file = s.file;
            const tdArtist = document.createElement("td");
            tdArtist.textContent = s.artist;
            const tdTitle = document.createElement("td");
            tdTitle.textContent = s.title;
            tr.appendChild(tdTitle);
            tr.appendChild(tdArtist);
            tr.addEventListener("click", () => {
                document.getElementById("filename").value = s.file;
                document.getElementById("song-input").value = s.display;
            });
            tbody.appendChild(tr);
        });

        // Awesomplete åˆæœŸåŒ–ï¼ˆè¡¨ç¤ºã¯ displayï¼‰
        const input = document.getElementById("song-input");
        const hidden = document.getElementById("filename");
        const awesomplete = new Awesomplete(input, {
            list: songs.map(s => s.display),
            minChars: 1,
            autoFirst: true
        });

        // å€™è£œé¸æŠæ™‚
        input.addEventListener("awesomplete-selectcomplete", function (e) {
            const selectedDisplay = e.text.value;
            const match = songs.find(s => s.display === selectedDisplay);
            hidden.value = match ? match.file : "";
        });

        // é€ä¿¡æ™‚ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯ç…§åˆ
        document.getElementById("play-form").addEventListener("submit", function(e){
            if (!hidden.value) {
                const val = input.value.trim();
                const match = songs.find(s => s.display === val);
                if (match) hidden.value = match.file;
            }
        });

        // color-form é€ä¿¡å‰ã« filename ã‚’ã‚³ãƒ”ãƒ¼
        document.getElementById("color-form").addEventListener("submit", function(e){
            const colorHidden = document.getElementById("color-filename");
            colorHidden.value = hidden.value || "";
        });
    </script>
    <div><a href="#" class="gotop"></a></div>

<!-- ãƒ¢ãƒ¼ãƒ€ãƒ«æœ¬ä½“ -->
<div id="modal" class="modal">
    <div class="modal-content">
    <span class="close">&times;</span>
    <h2>How to Use</h2>
    <h3>1.æ›²ã‚’é¸æŠã—ã¾ã™</h3>
    <p>
        æ¤œç´¢ãƒœãƒƒã‚¯ã‚¹ã‹ã‚‰æ›²ã‚’æ¤œç´¢ã™ã‚‹ã‹ã€ä¸‹ã®ã€Œæ›²ãƒªã‚¹ãƒˆã€ã®æ¥½æ›²ã‚’ã‚¿ãƒƒãƒ—ã™ã‚‹ã“ã¨ã§æ›²ã®é¸æŠãŒã§ãã¾ã™ã€‚<br>
    </p>
    <p>æ¤œç´¢ãƒœãƒƒã‚¯ã‚¹</p>
    <img src="{{ url_for('static', filename='image/search.jpg') }}" alt="æ›²é¸æŠç”»é¢ã®ä¾‹">
    <p>æ›²ãƒªã‚¹ãƒˆ</p>
    <img src="{{ url_for('static', filename='image/list.jpg') }}" alt="æ›²é¸æŠç”»é¢ã®ä¾‹">
    <p>ğŸ’¡hint<br>å³ä¸‹ã®ä¸ŠçŸ¢å°ã‚’æŠ¼ã™ã¨ãƒšãƒ¼ã‚¸ãƒˆãƒƒãƒ—ã¸ã¨æˆ»ã‚Šã¾ã™<br></p>
    <h3>2.ã€ŒéŸ³æ¥½ã«åˆã‚ã›ã¦å…‰ã‚‰ã›ã‚‹ã€ã¾ãŸã¯ã€Œè‰²ã‚’æ±ºã‚ã¦å…‰ã‚‰ã›ã‚‹ã€ãƒœã‚¿ãƒ³ã‚’æŠ¼ã—ã¾ã™ã€‚</h3>
    <p>
        <strong>éŸ³æ¥½ã«åˆã‚ã›ã¦å…‰ã‚‰ã›ã‚‹</strong>ï¼šéŸ³æ¥½ã®ç‰¹å¾´é‡ãªã©ã‹ã‚‰è¨ˆç®—ã—ã€éŸ³æ¥½ã®é›°å›²æ°—ã«åˆã‚ã›ãŸè‰²ã§ç”»é¢ãŒå…‰ã‚Šã¾ã™ã€‚<br>
        <strong>è‰²ã‚’æ±ºã‚ã¦å…‰ã‚‰ã›ã‚‹</strong>ï¼šãƒœã‚¿ãƒ³ã‚’æŠ¼ã™ã¨ã‚«ãƒ©ãƒ¼ãƒ”ãƒƒã‚«ãƒ¼ã§è‡ªåˆ†ã®å¥½ããªè‰²ã«ç”»é¢ã®è‰²ã‚’å¤‰ãˆã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚<br>
    </p>
    <p>ãƒœã‚¿ãƒ³</p>
    <img src="{{ url_for('static', filename='image/button.jpg') }}" alt="ãƒœã‚¿ãƒ³ã®è¡¨ç¤ºä¾‹">
    <p>ã‚«ãƒ©ãƒ¼ãƒ”ãƒƒã‚«ãƒ¼</p>
    <img src="{{ url_for('static', filename='image/colorpicker.jpg') }}" alt="ã‚«ãƒ©ãƒ¼ãƒ”ãƒƒã‚«ãƒ¼ã®è¡¨ç¤ºä¾‹">
    <h3>3.éŸ³æ¥½ã«åˆã‚ã›ã¦orè‡ªåˆ†ãŒæ±ºã‚ãŸè‰²ã§ç”»é¢ãŒå…‰ã‚Šã¾ã™</h3>
    <p>
        âš ï¸éŸ³æ¥½ãƒ•ã‚¡ã‚¤ãƒ«ã‚’é¸æŠã—ãªã„çŠ¶æ…‹ã§ãƒœã‚¿ãƒ³ã‚’æŠ¼ã™ã¨ã€ã‚¨ãƒ©ãƒ¼ãŒèµ·ã“ã‚Šã¾ã™ï¼<br>ãƒ•ã‚¡ã‚¤ãƒ«ã‚’é¸æŠã—ã¦ã‹ã‚‰ãƒœã‚¿ãƒ³ã‚’æŠ¼ã—ã¦ãã ã•ã„ã€‚<br>
    </p>
    </div>
  </div>

 <script>
  document.addEventListener('DOMContentLoaded', function() {
    const modal = document.getElementById('modal');
    const btn = document.getElementById('info-icon');
    const closeBtn = document.querySelector('.close');

    if (!modal || !btn || !closeBtn) {
      console.warn("ãƒ¢ãƒ¼ãƒ€ãƒ«è¦ç´ ãŒè¦‹ã¤ã‹ã‚‰ãªã„ï¼");
      return;
    }

    btn.addEventListener('click', function(e) {
      e.preventDefault();
      modal.style.display = 'block';
    });

    closeBtn.addEventListener('click', function() {
      modal.style.display = 'none';
    });

    function closeModalOnBackground(e) {
      if (e.target === modal) {
        modal.style.display = 'none';
      }
    }

    window.addEventListener('click', closeModalOnBackground);       // PCã‚¯ãƒªãƒƒã‚¯å¯¾å¿œ
    window.addEventListener('touchstart', closeModalOnBackground);  // ã‚¹ãƒãƒ›ã‚¿ãƒƒãƒ—å¯¾å¿œ
  });
</script>

</body>
</html>